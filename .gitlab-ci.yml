image: python:3

cache:
  paths:
    - .local

pages:
  stage: deploy
  before_script:
    - apt-get update && apt-get install -y default-jre-headless
    - wget -O /usr/local/lib/plantuml.jar http://sourceforge.net/projects/plantuml/files/plantuml.jar/download
    - |
      cat <<EOT > /usr/local/bin/plantuml
      #!/bin/sh -e
      java -Djava.awt.headless=true -splash:no -jar /usr/local/lib/plantuml.jar "$@"
      EOT
    - chmod +x /usr/local/bin/plantuml
    - pip install sphinx sphinxcontrib-plantuml

  script:
    - cd doc/
    - make html
    - mv _build/html/ ../public/

  artifacts:
      paths:
      - public

  only:
    - master
